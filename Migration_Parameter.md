# 迁移参数优化选项

## 1. announce-initial

发送第一个声明的初始延迟，单位是毫秒，默认是50毫秒

## 2. announce-max

通知中数据包的最大延迟，单位是毫秒，默认是550毫秒

## 3. announce-rounds

迁移之后发送自描述包的数量，默认是5个

## 4. announce-step

在通知中随后的数据包之间的延迟增加值，单位是毫秒，默认是100毫秒

## 5. compress-level

压缩等级由1（压缩速度最快）到9（压缩率最高）

在传输带宽不是限制因素的时候选择压缩等级1对于整体最快

## 6. compress-thread

参与压缩的线程数，默认是8

## 7. compress-wait-thread

在所有压缩线程都忙的时候，是否需要压缩再发送。默认是`true`，也就是等待到有线程空闲，再压缩再发送。如果为`false`则直接发送而不压缩

## 8. decompress-thread

解压缩线程数，默认是2，这里源码注释解压的速度至少是压缩速度的4倍，所以这里默认是2

## 9. throttle-trigger-threshold

这是节流阀选型，由节流阀可以确定传输字节数`bytes_xfer_period * threshold / 100;(ram.c)`这个值默认是50

检查脏字节和上次中所传输的大约字节量之间的比率是否达到阈值。如果这个事情发生两次就下一步行动。如果之前没有节流阀就启动节流阀，如果已经启动节流阀了就增加阈值。

## 10. cpu-throttle-initial

当迁移自动收敛被激活时（第一次需要节流阀时），客户cpu节流的初始时间百分比默认是20

## 11. cpu-throttle-increment

当自动收敛检测到迁移没有进展时（后面几次需要节流阀时），节流阀百分比增加，默认是20

`cpu-throttle-tailslow: boolean` (optional)

Make CPU throttling slower at tail stage At the tail stage of throttling, the Guest is very sensitive to CPU percentage while the `cpu-throttle` -increment is excessive usually at tail stage. If this parameter is true, we will compute the ideal CPU percentage used by the Guest, which may exactly make the dirty rate match the dirty rate threshold. Then we will choose a smaller throttle increment between the one specified by `cpu-throttle-increment` and the one generated by ideal CPU percentage. Therefore, it is compatible to traditional throttling, meanwhile the throttle increment won’t be excessive at tail stage. The default value is false. (Since 5.1)

`tls-creds: string` (optional)

ID of the ’tls-creds’ object that provides credentials for establishing a TLS connection over the migration data channel. On the outgoing side of the migration, the credentials must be for a ’client’ endpoint, while for the incoming side the credentials must be for a ’server’ endpoint. An empty string means that QEMU will use plain text mode for migration, rather than TLS (Since 2.7) Note: 2.8 reports this by omitting tls-creds instead.

`tls-hostname: string` (optional)

hostname of the target host for the migration. This is required when using x509 based TLS credentials and the migration URI does not already include a hostname. For example if using fd: or exec: based migration, the hostname must be provided so that the server’s x509 certificate identity can be validated. (Since 2.7) An empty string means that QEMU will use the hostname associated with the migration URI, if any. (Since 2.9) Note: 2.8 reports this by omitting tls-hostname instead.

`tls-authz: string` (optional)

ID of the ’authz’ object subclass that provides access control checking of the TLS x509 certificate distinguished name. (Since 4.0)

`max-bandwidth: int` (optional)

to set maximum speed for migration. maximum speed in bytes per second. (Since 2.8)

`downtime-limit: int` (optional)

set maximum tolerated downtime for migration. maximum downtime in milliseconds (Since 2.8)

`x-checkpoint-delay: int` (optional)

the delay time between two COLO checkpoints. (Since 2.8)

`block-incremental: boolean` (optional)

Affects how much storage is migrated when the block migration capability is enabled. When false, the entire storage backing chain is migrated into a flattened image at the destination; when true, only the active qcow2 layer is migrated and the destination must already have access to the same backing chain as was used on the source. (since 2.10)

`multifd-channels: int` (optional)

Number of channels used to migrate data in parallel. This is the same number that the number of sockets used for migration. The default value is 2 (since 4.0)

`xbzrle-cache-size: int` (optional)

cache size to be used by XBZRLE migration. It needs to be a multiple of the target page size and a power of 2 (Since 2.11)

`max-postcopy-bandwidth: int` (optional)

Background transfer bandwidth during postcopy. Defaults to 0 (unlimited). In bytes per second. (Since 3.0)

`max-cpu-throttle: int` (optional)

maximum cpu throttle percentage. Defaults to 99. (Since 3.1)

`multifd-compression: MultiFDCompression` (optional)

Which compression method to use. Defaults to none. (Since 5.0)

`multifd-zlib-level: int` (optional)

Set the compression level to be used in live migration, the compression level is an integer between 0 and 9, where 0 means no compression, 1 means the best compression speed, and 9 means best compression ratio which will consume more CPU. Defaults to 1. (Since 5.0)

`multifd-zstd-level: int` (optional)

Set the compression level to be used in live migration, the compression level is an integer between 0 and 20, where 0 means no compression, 1 means the best compression speed, and 20 means best compression ratio which will consume more CPU. Defaults to 1. (Since 5.0)

